---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-same-namespace
  annotations:
    argocd.argoproj.io/sync-wave: "0"
spec:
  podSelector: {}
  policyTypes:
    - Ingress
    - Egress
  ingress:
    # Allow traffic from pods in the same namespace
    - from:
        - podSelector: {}
    # Allow traffic from OpenShift ingress
    - from:
        - namespaceSelector:
            matchLabels:
              policy-group.network.openshift.io/ingress: ""
    # Allow traffic from OpenShift monitoring
    - from:
        - namespaceSelector:
            matchLabels:
              network.openshift.io/policy-group: monitoring
  egress:
    # Allow DNS resolution
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: openshift-dns
      ports:
        - protocol: UDP
          port: 5353
    # Allow traffic to pods in the same namespace
    - to:
        - podSelector: {}
    # Allow all egress traffic (for simplicity and to avoid blocking critical services)
    # In production, you may want to restrict this further based on your security requirements
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
        - protocol: UDP
